<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaft.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>광고 상세 정보</title>
</head>
<body>
<script type="text/javascript">
    function update() {
        var form = $('#detailForm')[0];
        var data = new FormData(form);
        var id = $('#updateId').val();

        $.ajax({
            type: "PUT",
            url: "/core/v1/creative/" + id,
            enctype: 'multipart/form-data',
            data: data,
            contentType: false,
            processData: false,
            cache: false
        }).done(function() {
            alert("수정 성공");
            location.href = "/detail/" + id;
        }).fail(function(err) {
            var respErr = err.responseJSON;
            console.log(respErr);
            if(respErr.status === 400){
                if(respErr.errors.length === 0) {
                    alert("종료일시가 시작일시보다 과거의 시간이면 안됩니다");
                } else {
                    var errors = respErr.errors;
                    var str = "입력값 오류 목록\n";
                    for(var i = 0; i < errors.length; i++) {
                        str += "- " + errors[i].field + "칸이 " + errors[i].reason + "\n";
                    }
                    alert(str);
                }
            } else {
                alert(err.responseJSON.message);
            }
        })
    }
    function deleteCreative() {
        var confirm = window.confirm("정말로 삭제하시겠습니까?");
        var id = $('#updateId').val();

        if(confirm){
            $.ajax({
                type: "DELETE",
                url: "/core/v1/creative/" + id
            }).done(function() {
                alert("삭제가 성공하였습니다.");
                location.href ='/';
            }).fail(function(err) {
                alert(err.responseJSON.message);
            })
        } else {
            alert("삭제가 취소되었습니다.");
        }
    }
    function updateMode() {
        document.getElementById("btn-update").removeAttribute("hidden");
        document.getElementById("btn-update-mode").setAttribute("hidden", "hidden");

        document.getElementById("title").removeAttribute("hidden");
        document.getElementById("price").removeAttribute("hidden");
        document.getElementById("updateImage").removeAttribute("hidden");
        document.getElementById("advertiseStartDate").removeAttribute("hidden");
        document.getElementById("advertiseEndDate").removeAttribute("hidden");
    }
</script>
<input hidden type="text" id="updateId" th:value="${creative.id}">
<div>
    <fieldset>
        <form id="detailForm">
            <table>
                <tr>
                    <th>제목</th>
                    <td><p th:text="${creative.title}"></p></td>
                </tr>
                <tr id="title" hidden>
                    <th>수정할 제목</th>
                    <td><input type="text" name="title" th:value="${creative.title}"></td>
                </tr>
                <tr>
                    <th>낙찰가</th>
                    <td><p th:text="${creative.price}"></p></td>
                </tr>
                <tr id="price" hidden>
                    <th>수정할 낙찰가</th>
                    <td><input type="number" name="price" th:value="${creative.price}"></td>
                </tr>
                <tr>
                    <th>이미지</th>
                    <td><img id="image" th:src="'http://localhost:8081/images/' + ${creativeImage.name}" width="300px" height="100px"></td>
                </tr>
                <tr id="updateImage" hidden>
                    <th>수정할 이미지</th>
                    <td><input type="file" name="images"></td>
                </tr>
                <tr>
                    <th>시작일자</th>
                    <td><p th:text="${creative.advertiseStartDate}"></p></td>
                </tr>
                <tr id="advertiseStartDate" hidden>
                    <th>수정할 시작일자</th>
                    <td><input type="datetime-local" name="advertiseStartDate" th:value="${creative.advertiseStartDate}"></td>
                </tr>
                <tr>
                    <th>종료일자</th>
                    <td><p th:text="${creative.advertiseEndDate}"></p></td>
                </tr>
                <tr id="advertiseEndDate" hidden>
                    <th>수정할 종료일자</th>
                    <td><input type="datetime-local" name="advertiseEndDate" th:value="${creative.advertiseEndDate}"></td>
                </tr>
            </table>
        </form>
        <button id="btn-update" onclick="update()" hidden>수정하기</button>
        <button id="btn-update-mode" onclick="updateMode()">수정</button>
        <button id="btn-delete" onclick="deleteCreative()">삭제</button>
    </fieldset>
</div>
<a href="/">광고 목록</a>
</body>
</html>